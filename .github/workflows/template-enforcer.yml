name: "PR Template Enforcer"

on:
  pull_request:
    types: [opened, edited, synchronized]

jobs:
  check-template:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Template Usage
        uses: actions/github-script@v6
        with:
          script: |
            const body = context.payload.pull_request.body || "";
            const branch = context.payload.pull_request.head.ref;
            let failed = false;
            let message = "";

            // Mapping branch prefixes to their required hidden IDs
            const rules = [
              { prefix: 'feature/', id: 'FEATURE_TEMPLATE_v1', name: 'Feature' },
              { prefix: 'experiment/', id: 'EXPERIMENT_TEMPLATE_v1', name: 'Experiment' },
              { prefix: 'bugfix/', id: 'BUGFIX_TEMPLATE_v1', name: 'Bugfix' },
              { prefix: 'hotfix/', id: 'hotfox_template.md', name: 'Hotfix' },
            ];

            const activeRule = rules.find(r => branch.startsWith(r.prefix));

            if (activeRule) {
              if (!body.includes(activeRule.id)) {
                failed = true;
                message = `❌ Error: This is a ${activeRule.name} branch. You must use the ${activeRule.name} Template link in the PR description to load the correct checklist.`;
              }
            } else {
              // Optional: Rule for branches that don't follow the naming convention
              if (body.length < 50) {
                failed = true;
                message = "❌ Error: Please provide a detailed PR description using one of our engineering templates.";
              }
            }

            if (failed) {
              core.setFailed(message);
            }

            
